%header.global-header
  .wrapper
      
    .select-tribe.toggle.hidden{data: {toggle: '.tribe-menu'}}
      .current-tribe
        = @current_community.name
      %i.icon-dropdown.ss-dropdown
    
    - if @current_user  
      
      %a.notifications-toggle.toggle.hidden#notifications_link{href: notifications_person_messages_path(:person_id => @current_user.id.to_s), title: t("layouts.conversations.notifications")}
        %i.icon.ss-earth
        = render :partial => "layouts/notifications_badge"

      %a.inbox-toggle.toggle.hidden#inbox-link{href: received_person_messages_path(:person_id => @current_user.id.to_s), title: t("layouts.conversations.messages")}
        %i.icon.ss-mail
        = render :partial => "layouts/messages_badge"
    
      .user-menu-toggle.toggle.hidden{data: {toggle: '.user-menu'}}
        = image_tag @current_user.image.url(:thumb), alt: '', class: 'user-avatar'
        .user-name= @current_user.name_or_username

        %i.icon-dropdown.ss-dropdown
        = render :partial => "layouts/user_badge"
    
    - else  
    
      .login-menu-toggle.toggle.hidden#login-toggle-button{data: {toggle: '.login-menu'}}
        .login-icon.ss-login
        .login-text= t("layouts.logged_in.login")
        
      %a.feedback-menu-toggle.toggle.hidden{href: new_user_feedback_path}
        .feedback-icon.ss-megaphone
        .feedback-text= t("header.contact_us")
      
      
    %nav.tribe-menu.toggle-menu.hidden
      %a{href: "#{@current_community.full_url}"}= @current_community.full_name
      - if @current_user && @current_user.communities.present?
        - @current_user.communities.each do |community|
          - unless community == @current_community
            %a{href: "#{community.full_url}", on_click: "_gaq.push(['_link', '#{community.full_url}']); return false;"}
              = community.full_name
      %a{href: dashboard_link(:locale => I18n.locale, :ref => "gh"), on_click: "_gaq.push(['_link', '#{dashboard_link(:locale => I18n.locale, :ref => "gh")}']); return false;"}
        = t("header.create_new_marketplace")
    
    - if @current_user
      %nav.user-menu.toggle-menu.hidden
        %a.profile-menu-button{href: person_path(@current_user)}
          .ss-user.icon-with-text
          .text-with-icon
            = t("header.profile")
        %a.inbox-menu-button{href: received_person_messages_path(:person_id => @current_user.id.to_s)}
          .ss-mail.icon-with-text
          .text-with-icon
            = t("layouts.conversations.messages") 
            = render :partial => "layouts/messages_badge"
        %a.notifications-menu-button{href: notifications_person_messages_path(:person_id => @current_user.id.to_s)}
          .ss-earth.icon-with-text
          .text-with-icon
            = t("layouts.conversations.notifications")
            = render :partial => "layouts/notifications_badge"
        %a.feedback-menu-button{href: new_user_feedback_path}
          .ss-megaphone.icon-with-text
          .text-with-icon
            = t("header.contact_us")
        %a{href: person_settings_path(@current_user)}
          .ss-settings.icon-with-text
          .text-with-icon
            = t("layouts.logged_in.settings")
        %a{href: logout_path}
          .ss-logout.icon-with-text
          .text-with-icon
            = t("layouts.logged_in.logout")
    
    %nav.login-menu.toggle-menu.hidden
      = form_tag("#{APP_CONFIG.login_domain}#{sessions_path}",:action => "create") do
        - if @current_community
          = hidden_field_tag :community, @current_community.domain
        - if APP_CONFIG.fb_connect_id && ! @facebook_merge && @current_community && ! @current_community.label.eql?("okl")
          %a.fb-connect{:href => person_omniauth_authorize_path(:facebook)}
            %i.ss-icon.ss-social.ss-facebook.fb-icon
            .fb-text= t("sessions.new.log_in_with_your_facebook_account")
          %p.login-form= t("sessions.new.or_sign_up_with_your_username")
        = text_field_tag "person[login]", nil, :value => session[:form_login], :placeholder => t("common.username_or_email"), :id => :upper_person_login
        = password_field_tag "person[password]", nil, :placeholder => t("common.password"), :id => :upper_person_password
        = button_tag t('sessions.new.login')
        = link_to t('sessions.new.create_new_account'), sign_up_path, :class => "login-form"
        = link_to t('sessions.new.i_forgot_my_password'), login_path(:password_forgotten => true), :class => "login-form"
        
          