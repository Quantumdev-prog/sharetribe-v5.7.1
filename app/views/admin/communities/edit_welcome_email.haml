= render :partial => "admin/left_hand_navigation", :locals => { :links => admin_links_for(@current_community) }

- content_for :extra_javascript do
  :javascript
    $(document).ready(function() {
      window.ST.initializeSenderEmailForm(#{user_defined_address.to_json}, "#{status_check_url}");
    });

- content_for :title_header do
  %h1
    = t("layouts.admin.admin")
    = "-"
    = t("admin.left_hand_navigation.emails_title")

.left-navi-section

  - if feature_enabled?(:sender_address)
    .row
      .col-12
        - contact_support_link = link_to t("admin.communities.outgoing_email.contact_support_link_text"), "mailto:#{support_email}", "data-uv-trigger" => "contact"

        %h2= t("admin.communities.outgoing_email.title")

        %p= t("admin.communities.outgoing_email.info")

    .row
      .col-12
        .sender-address-preview
          - if user_defined_address.nil?
            = t("admin.communities.outgoing_email.sender_address_default", sender_address: sender_address)
          - else
            = t("admin.communities.outgoing_email.sender_address", sender_address: sender_address)

    - unless user_defined_address.nil?
      - content_for(:verification_status) do
        - case user_defined_address[:verification_status]
        - when :verified
          %span.status-verified
            = t("admin.communities.outgoing_email.status_verified");
        - else
          = t("admin.communities.outgoing_email.status_unknown");

      .row
        .col-12
          = t("admin.communities.outgoing_email.status", status: content_for(:verification_status)).html_safe
      .row
        .col-12
          = t("admin.communities.outgoing_email.need_to_change", contact_support_link: contact_support_link).html_safe

    - if user_defined_address.nil?
      .row
        .col-12
          %h3= t("admin.communities.outgoing_email.set_sender_address")

      = form_tag(post_sender_address_url, method: :post, class: "js-sender-email-form") do
        .row
          .col-6
            %label.sender-address-label= t("admin.communities.outgoing_email.sender_name_label")
            %input.js-sender-name-input{name: "name", type: :text, placeholder: t("admin.communities.outgoing_email.sender_name_placeholder")}
          .col-6
            %label.sender-address-label= t("admin.communities.outgoing_email.sender_email_label")
            %input.js-sender-email-input{name: "email", type: :text, placeholder: t("admin.communities.outgoing_email.sender_email_placeholder")}

        .row.js-sender-address-preview-container.sender-address-preview-container.hidden
          .col-12
            .sender-address-preview
              = t("admin.communities.outgoing_email.this_is_how_it_will_look")
              %span.js-sender-address-preview-values
        .row
          %button= t("admin.communities.outgoing_email.send_verification_button")


  %h2= t(".welcome_email_content", :community_name => @community.name(I18n.locale))
  %p= t(".welcome_email_content_description", :send_test_message_link => t(".send_test_message"))
  %a{:id => "edit_link", :href => "/editor" + request.path, :data => { :save_url => mercury_update_path }}
    .icon-with-text-container
      = icon_tag("edit", ["icon-part"])
      .text-part= t(".edit_message")

  %a{:href => test_welcome_email_admin_community_path(@community)}
    .icon-with-text-container
      = icon_tag("mail", ["icon-part"])
      .text-part= t(".send_test_message")
  %p ***
  .welcome-email-editor-background
    %p= t("emails.common.hey", :name => @recipient.given_name_or_username)
    #welcome_email_content{:data => {:mercury => "full"}}
      - if @community_customization && @community_customization.welcome_email_content
        = @community_customization.welcome_email_content.html_safe
      - else
        = render :partial => "admin/communities/default_welcome_email"
