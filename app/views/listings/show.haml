- content_for :javascript do
  initialize_listing_view('#{I18n.locale}');

- content_for :extra_javascript do
  = javascript_include_tag "https://maps.google.com/maps/api/js?sensor=true"

.view-item
  
  .item-description.section
      
    %h1
      = listed_listing_title(@listing)
    
    - if @listing.valid_until && @listing.category.eql?("rideshare")
      .listing-departure-time
        .icon-with-text-container
          %i.ss-car.icon-part 
          .text-part
            %strong
              = t("listings.form.departure_time.departure_time") + ": " + l(@listing.valid_until, :format => :short)
    
    #listing_message_links
      = render :partial => "message_links"
    
    - unless @listing.listing_images.empty?
      .item-image
        - @listing.listing_images.each do |listing_image|
          %a{:href => "#", :id => "listing-image-link"}
            = image_tag listing_image.image.url(:medium), :alt => listed_listing_title(@listing)
    
    - if @listing.description && !@listing.description.blank?
      - text_with_line_breaks do
        = @listing.description

    .listing-icons
      -# This will be used when listings can have a price
      -#.listing-icon
      -#  %i.ss-pricetag.icon-with-text 
      -#  .text-with-icon 22â‚¬ / hour
      .icon-with-text-container
        %i.ss-calendar.icon-part 
        .text-part
          = t(".#{@listing.listing_type}_created") + " " + time_ago(@listing.created_at)
      .icon-with-text-container
        %i.ss-view.icon-part
        .text-part
          = t(".times_viewed")
          = pluralize(@listing.times_viewed.to_s, t(".time"), t(".times"))
      - if @listing.valid_until && @listing.open? && !@listing.category.eql?("rideshare")
        .icon-with-text-container
          %i.ss-alarmclock.icon-part 
          .text-part
            = t(".open_until", :date => l(@listing.valid_until, :format => :short))
    
    - if @listing.public? && ! @current_community.private? 
      .social
        .fb-like-container
          = facebook_like(current_user?(@listing.author))
        .tweet-button-container
          = link_to("", "https://twitter.com/share", :class => "twitter-share-button", "data-count" => "horizontal", "data-via" => "Sharetribe")
          %script{:type => "text/javascript", :src => "https://platform.twitter.com/widgets.js"}

    .listing-author
      .listing-author-image
        = medium_avatar_thumb(@listing.author)    
      .listing-author-description
        %h3
          = t(".#{@listing.listing_type}_author")
          = link_to @listing.author.name, @listing.author, :id => "listing_author_link"
        - if @listing.author.received_testimonials.size > 0
          %br/
          .icon-with-text-container
            .ss-like.icon-part
            .text-part
              = t(".feedback")
              = @listing.author.feedback_positive_percentage.to_s + "%"
              = t("people.show.positive")
              = "(#{@listing.author.received_positive_testimonials.size}/#{@listing.author.received_testimonials.size})"
        - unless @listing.closed? || current_user?(@listing.author)
          %br/
          %a{href: reply_to_listing_path(:id => @listing.id.to_s, :message_type => "free"), id: "message_listing_author_link"}
            .icon-with-text-container
              .ss-mail.icon-part
              .text-part= t(".send_private_message")
        - if @current_user && @current_user.member_of?(@current_community) && @listing.author.phone_number && !@listing.author.phone_number.blank? && !@listing.closed?
          %br/
          .icon-with-text-container
            .ss-phone.icon-part
            .text-part
              - if @listing.author.phone_number && !@listing.author.phone_number.blank?
                = @listing.author.phone_number
              - elsif current_user?(@listing.author)
                = link_to t(".add_your_phone_number"), person_settings_path(:person_id => @current_user.id)

    - if @listing.origin_loc && @listing.origin_loc.address != ""
      #googlemap
        = render :partial => "googlemap", :locals => { :rideshare => (@listing.category == "rideshare"), :listing => @listing}
        = render :partial => "origin", :locals => { :origin_loc => @listing.origin_loc }
        - if @listing.category == "rideshare"
          = render :partial => "destination", :locals => { :destination_loc => @listing.destination_loc }
        
    .bottom-margin  
  
  #comments.discussion.section
    %h2 
      .ss-chat.icon-with-text
      .text-with-icon
        = t(".comments")
        %span= "(#{@listing.comments.count})"
    
    #comment-list
      = render :partial => "comment", :collection => @listing.comments
    #comment-form
      = render :partial => "comment_form"

- unless @listing.listing_images.empty?
  #listing-image-lightbox.lightbox.image-lightbox
    .lightbox-content.image-lightbox-content
      %a{:href => "#", :class => "close lightbox-x", :id => "close_x"}
        .ss-delete
      = image_tag @listing.listing_images.first.image.url(:original)